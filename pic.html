<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线图片处理工具 - 图片压缩、编辑、转换、裁剪、ICO转换、修改DPI和尺寸 | 娃娃团队</title>
    <meta name="keywords" content="在线图片处理,图片压缩,图片编辑,图片转换,图片裁剪,ICO图标转换,修改图片DPI,调整图片尺寸,批量图片处理,免费图片工具">
    <meta name="description" content="专业在线图片处理工具，支持图片压缩、编辑、格式转换、裁剪、ICO图标制作、批量修改DPI和调整尺寸等功能，上传图片即可实时预览效果并下载，简单高效免费使用。">
    <!-- 隐藏的SEO链接 -->
    <div style="display:none;visibility:hidden;height:0;width:0;">
        <a href="https://www.yava.pw" rel="nofollow">娃娃团队</a>
    </div>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.staticfile.net/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-transform {
                transition-property: transform;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 300ms;
            }
            .hover-scale {
                @apply hover:scale-105 transition-all duration-300;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .crop-overlay {
                position: absolute;
                border: 1px dashed #3B82F6;
                background-color: rgba(59, 130, 246, 0.1);
                cursor: move;
            }
            .crop-handle {
                position: absolute;
                width: 10px;
                height: 10px;
                background-color: #3B82F6;
                border: 1px solid white;
            }
            .protected-footer {
                user-select: none;
                pointer-events: none;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 text-dark">
    <!-- 导航栏 -->
    <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
        <div class="container mx-auto px-4 py-3 flex flex-wrap items-center justify-between">
            <div class="flex items-center">
                <i class="fa fa-picture-o text-primary text-3xl mr-3"></i>
                <h1 class="text-xl md:text-2xl font-bold text-dark">
                    <span class="text-primary">图片</span>处理工具
                </h1>
            </div>
            
            <button id="menu-toggle" class="md:hidden text-gray-600 focus:outline-none">
                <i class="fa fa-bars text-xl"></i>
            </button>
            
            <nav id="menu" class="hidden w-full md:flex md:w-auto mt-4 md:mt-0">
                <ul class="flex flex-col md:flex-row md:space-x-6 space-y-2 md:space-y-0">
                    <li><a href="#features" class="text-gray-600 hover:text-primary transition-colors">功能</a></li>
                    <li><a href="#how-it-works" class="text-gray-600 hover:text-primary transition-colors">使用方法</a></li>
                    <li><a href="#tools" class="text-gray-600 hover:text-primary transition-colors">工具</a></li>
                    <li><a href="#faq" class="text-gray-600 hover:text-primary transition-colors">常见问题</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- 英雄区域 -->
    <section class="bg-gradient-to-r from-primary to-accent text-white py-16 md:py-24">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-6 text-shadow">
                一站式图片处理解决方案
            </h2>
            <p class="text-[clamp(1rem,2vw,1.25rem)] mb-8 max-w-3xl mx-auto opacity-90">
                压缩、编辑、转换、裁剪、制作ICO图标、修改DPI和尺寸，所有功能在线完成，无需安装软件
            </p>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <a href="#main-content" class="bg-white text-primary font-semibold py-3 px-8 rounded-lg shadow-lg hover:shadow-xl transition-all hover-scale">
                    <i class="fa fa-upload mr-2"></i>开始处理图片
                </a>
                <a href="#features" class="bg-transparent border-2 border-white text-white font-semibold py-3 px-8 rounded-lg hover:bg-white/10 transition-all">
                    <i class="fa fa-info-circle mr-2"></i>了解更多
                </a>
            </div>
        </div>
    </section>

    <!-- 主内容区 - 左侧工具选项，右侧处理区域 -->
    <section id="main-content" class="py-12 bg-white">
        <div class="container mx-auto px-4">
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- 左侧工具选项 -->
                <div id="tools" class="lg:w-1/4 bg-gray-50 p-6 rounded-xl shadow-md">
                    <h2 class="text-2xl font-bold mb-6">处理工具</h2>
                    <div class="space-y-3">
                        <!-- 图片压缩工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="compress">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-compress text-primary"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">图片压缩</h3>
                                    <p class="text-gray-600 text-xs">减小文件大小，保持清晰度</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图片编辑工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="edit">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-secondary/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-paint-brush text-secondary"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">图片编辑</h3>
                                    <p class="text-gray-600 text-xs">调整亮度、对比度、饱和度</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图片转换工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="convert">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-accent/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-exchange text-accent"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">格式转换</h3>
                                    <p class="text-gray-600 text-xs">转换为JPG、PNG、GIF、WebP等</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 图片裁剪工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="crop">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-orange-500/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-scissors text-orange-500"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">图片裁剪</h3>
                                    <p class="text-gray-600 text-xs">自由裁剪或按比例裁剪</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ICO转换工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="ico">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-red-500/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-file-image-o text-red-500"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">ICO转换</h3>
                                    <p class="text-gray-600 text-xs">将图片转换为ICO图标</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- DPI修改工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="dpi">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-purple-500/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-dot-circle-o text-purple-500"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">修改DPI</h3>
                                    <p class="text-gray-600 text-xs">调整图片分辨率(DPI)</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 背景透明工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="transparent">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-green-500/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-magic text-green-500"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">背景透明</h3>
                                    <p class="text-gray-600 text-xs">去除图片纯色背景</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 尺寸调整工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="resize">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-teal-500/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-arrows-alt text-teal-500"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">调整尺寸</h3>
                                    <p class="text-gray-600 text-xs">按像素或比例调整大小</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 批量处理工具 -->
                        <div class="tool-card bg-white rounded-xl p-4 shadow-sm hover:shadow-md transition-all hover-scale border border-gray-100 cursor-pointer" data-tool="batch">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-blue-700/10 rounded-full flex items-center justify-center mr-3">
                                    <i class="fa fa-files-o text-blue-700"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">批量处理</h3>
                                    <p class="text-gray-600 text-xs">批量处理多张图片</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 右侧处理区域 -->
                <div class="lg:w-3/4 space-y-8">
                    <!-- 上传区域 -->
                    <div id="upload" class="bg-gray-50 p-6 rounded-xl shadow-md">
                        <h2 class="text-2xl font-bold mb-4">上传图片</h2>
                        <p class="text-gray-600 mb-6">支持JPG、PNG、GIF、BMP等多种格式，文件大小不超过10MB</p>
                        
                        <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-xl p-10 text-center hover:border-primary transition-colors cursor-pointer bg-white">
                            <i class="fa fa-cloud-upload text-5xl text-primary mb-4"></i>
                            <p class="text-gray-600 mb-2">拖放图片到此处，或</p>
                            <button id="upload-btn" class="bg-primary text-white font-medium py-2 px-6 rounded-lg hover:bg-primary/90 transition-colors">
                                选择图片文件
                            </button>
                            <input type="file" id="file-input" accept="image/*" multiple class="hidden">
                            <p id="file-info" class="mt-4 text-gray-500 text-sm"></p>
                        </div>
                        
                        <div id="uploaded-images" class="mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 hidden">
                            <!-- 上传的图片将在这里显示 -->
                        </div>
                    </div>
                    
                    <!-- 处理选项和预览区域 -->
                    <div id="processing" class="bg-gray-50 p-6 rounded-xl shadow-md hidden">
                        <h2 class="text-2xl font-bold mb-6" id="processing-title">图片压缩设置</h2>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                            <!-- 处理选项 -->
                            <div class="lg:col-span-2 bg-white p-5 rounded-lg shadow-sm">
                                <h3 class="text-lg font-semibold mb-4">处理选项</h3>
                                <div id="processing-options">
                                    <!-- 压缩选项 -->
                                    <div id="compress-options" class="tool-options">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">压缩质量</label>
                                            <input type="range" id="quality" min="1" max="100" value="80" 
                                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                <span>低质量 (小文件)</span>
                                                <span id="quality-value">80%</span>
                                                <span>高质量 (大文件)</span>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">压缩模式</label>
                                            <select id="compress-mode" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="balanced">平衡模式 (推荐)</option>
                                                <option value="high">高效压缩</option>
                                                <option value="lossless">无损压缩</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- 编辑选项 -->
                                    <div id="edit-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">亮度</label>
                                            <input type="range" id="brightness" min="-100" max="100" value="0" 
                                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                <span>-100</span>
                                                <span id="brightness-value">0</span>
                                                <span>100</span>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">对比度</label>
                                            <input type="range" id="contrast" min="-100" max="100" value="0" 
                                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                <span>-100</span>
                                                <span id="contrast-value">0</span>
                                                <span>100</span>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">饱和度</label>
                                            <input type="range" id="saturation" min="-100" max="100" value="0" 
                                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                <span>-100</span>
                                                <span id="saturation-value">0</span>
                                                <span>100</span>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">滤镜</label>
                                            <select id="filter" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="none">无</option>
                                                <option value="grayscale">黑白</option>
                                                <option value="sepia">复古</option>
                                                <option value="invert">反色</option>
                                                <option value="bright">明亮</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- 背景透明选项 -->
                                    <div id="transparent-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">背景透明度容差值</label>
                                            <input type="range" id="tolerance" min="0" max="100" value="30" 
                                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                <span>精确</span>
                                                <span id="tolerance-value">30</span>
                                                <span>宽松</span>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <p class="text-sm text-gray-600">较高的容差值可以去除更多的背景，但可能会影响前景图像</p>
                                        </div>
                                    </div>
                                    
                                    <!-- 转换选项 -->
                                    <div id="convert-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">目标格式</label>
                                            <select id="target-format" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="jpg">JPG</option>
                                                <option value="png">PNG</option>
                                                <option value="webp">WebP</option>
                                                <option value="bmp">BMP</option>
                                                <option value="gif">GIF</option>
                                            </select>
                                        </div>
                                        <div class="mb-4" id="jpg-options">
                                            <label class="block text-gray-700 mb-2">JPG 质量</label>
                                            <input type="range" id="jpg-quality" min="1" max="100" value="80" 
                                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                            <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                <span>低</span>
                                                <span id="jpg-quality-value">80%</span>
                                                <span>高</span>
                                            </div>
                                        </div>
                                        <div class="mb-4" id="png-options">
                                            <label class="block text-gray-700 mb-2">PNG 压缩级别</label>
                                            <select id="png-compression" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="0">无压缩</option>
                                                <option value="1">低</option>
                                                <option value="2" selected>中低</option>
                                                <option value="3">中</option>
                                                <option value="4">中高</option>
                                                <option value="5">高</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- 裁剪选项 -->
                                    <div id="crop-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">裁剪比例</label>
                                            <select id="crop-ratio" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="free">自由裁剪</option>
                                                <option value="1:1">1:1 (正方形)</option>
                                                <option value="4:3">4:3 (标准)</option>
                                                <option value="16:9">16:9 (宽屏)</option>
                                                <option value="3:2">3:2 (照片)</option>
                                            </select>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">裁剪位置 (预设比例时)</label>
                                            <select id="crop-position" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="center">居中</option>
                                                <option value="top">顶部</option>
                                                <option value="bottom">底部</option>
                                                <option value="left">左侧</option>
                                                <option value="right">右侧</option>
                                            </select>
                                        </div>
                                        <div class="mb-4">
                                            <button id="crop-reset" class="bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                                                <i class="fa fa-refresh mr-1"></i> 重置裁剪区域
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- ICO转换选项 -->
                                    <div id="ico-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">ICO尺寸 (可多选)</label>
                                            <div class="grid grid-cols-3 gap-2">
                                                <label class="flex items-center p-2 border border-gray-200 rounded">
                                                    <input type="checkbox" value="16" checked class="mr-2 accent-primary"> 16x16
                                                </label>
                                                <label class="flex items-center p-2 border border-gray-200 rounded">
                                                    <input type="checkbox" value="32" checked class="mr-2 accent-primary"> 32x32
                                                </label>
                                                <label class="flex items-center p-2 border border-gray-200 rounded">
                                                    <input type="checkbox" value="48" checked class="mr-2 accent-primary"> 48x48
                                                </label>
                                                <label class="flex items-center p-2 border border-gray-200 rounded">
                                                    <input type="checkbox" value="64" class="mr-2 accent-primary"> 64x64
                                                </label>
                                                <label class="flex items-center p-2 border border-gray-200 rounded">
                                                    <input type="checkbox" value="128" checked class="mr-2 accent-primary"> 128x128
                                                </label>
                                                <label class="flex items-center p-2 border border-gray-200 rounded">
                                                    <input type="checkbox" value="256" class="mr-2 accent-primary"> 256x256
                                                </label>
                                            </div>
                                        </div>
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">透明处理</label>
                                            <select id="ico-transparency" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="preserve">保留原图透明</option>
                                                <option value="white">白色背景</option>
                                                <option value="black">黑色背景</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <!-- DPI修改选项 -->
                                    <div id="dpi-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">目标DPI</label>
                                            <select id="target-dpi" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="72">72 DPI (屏幕显示)</option>
                                                <option value="96">96 DPI (网页)</option>
                                                <option value="150">150 DPI (低质量打印)</option>
                                                <option value="300" selected>300 DPI (高质量打印)</option>
                                                <option value="600">600 DPI (专业印刷)</option>
                                                <option value="custom">自定义</option>
                                            </select>
                                        </div>
                                        <div class="mb-4 hidden" id="custom-dpi-input">
                                            <label class="block text-gray-700 mb-2">自定义DPI值</label>
                                            <input type="number" id="custom-dpi" min="1" max="2400" value="300" 
                                                class="w-full p-2 border border-gray-300 rounded-lg">
                                        </div>
                                        <div class="mb-4">
                                            <label class="flex items-center">
                                                <input type="checkbox" id="resize-with-dpi" checked class="mr-2 accent-primary">
                                                <span>随DPI调整像素尺寸</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- 尺寸调整选项 -->
                                    <div id="resize-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">调整方式</label>
                                            <select id="resize-method" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="percentage">按百分比</option>
                                                <option value="pixels" selected>按像素</option>
                                            </select>
                                        </div>
                                        
                                        <div id="percentage-resize" class="hidden">
                                            <div class="mb-4">
                                                <label class="block text-gray-700 mb-2">缩放比例</label>
                                                <input type="range" id="resize-percentage" min="10" max="200" value="100" 
                                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                                <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                    <span>10%</span>
                                                    <span id="resize-percentage-value">100%</span>
                                                    <span>200%</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div id="pixel-resize">
                                            <div class="grid grid-cols-2 gap-4 mb-4">
                                                <div>
                                                    <label class="block text-gray-700 mb-2">宽度 (像素)</label>
                                                    <input type="number" id="resize-width" min="10" value="800" 
                                                        class="w-full p-2 border border-gray-300 rounded-lg">
                                                </div>
                                                <div>
                                                    <label class="block text-gray-700 mb-2">高度 (像素)</label>
                                                    <input type="number" id="resize-height" min="10" value="600" 
                                                        class="w-full p-2 border border-gray-300 rounded-lg">
                                                </div>
                                            </div>
                                            <div class="mb-4">
                                                <label class="flex items-center">
                                                    <input type="checkbox" id="maintain-aspect" checked class="mr-2 accent-primary">
                                                    <span>保持宽高比</span>
                                                </label>
                                            </div>
                                            <div class="mb-4">
                                                <label class="block text-gray-700 mb-2">缩放算法</label>
                                                <select id="resize-algorithm" class="w-full p-2 border border-gray-300 rounded-lg">
                                                    <option value="bilinear">双线性 (平衡)</option>
                                                    <option value="nearest">最近邻 (快速)</option>
                                                    <option value="bicubic" selected>双三次 (高质量)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 批量处理选项 -->
                                    <div id="batch-options" class="tool-options hidden">
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">选择批量操作</label>
                                            <select id="batch-operation" class="w-full p-2 border border-gray-300 rounded-lg">
                                                <option value="compress">压缩图片</option>
                                                <option value="convert">格式转换</option>
                                                <option value="resize">调整尺寸</option>
                                                <option value="dpi">修改DPI</option>
                                            </select>
                                        </div>
                                        
                                        <div id="batch-compress-settings" class="batch-settings">
                                            <div class="mb-4">
                                                <label class="block text-gray-700 mb-2">压缩质量</label>
                                                <input type="range" id="batch-quality" min="1" max="100" value="80" 
                                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                                <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                    <span>低</span>
                                                    <span id="batch-quality-value">80%</span>
                                                    <span>高</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div id="batch-convert-settings" class="batch-settings hidden">
                                            <div class="mb-4">
                                                <label class="block text-gray-700 mb-2">目标格式</label>
                                                <select id="batch-target-format" class="w-full p-2 border border-gray-300 rounded-lg">
                                                    <option value="jpg">JPG</option>
                                                    <option value="png">PNG</option>
                                                    <option value="webp">WebP</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div id="batch-resize-settings" class="batch-settings hidden">
                                            <div class="mb-4">
                                                <label class="block text-gray-700 mb-2">缩放比例</label>
                                                <input type="range" id="batch-resize-percentage" min="10" max="200" value="100" 
                                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary">
                                                <div class="flex justify-between text-sm text-gray-500 mt-1">
                                                    <span>10%</span>
                                                    <span id="batch-resize-value">100%</span>
                                                    <span>200%</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div id="batch-dpi-settings" class="batch-settings hidden">
                                            <div class="mb-4">
                                                <label class="block text-gray-700 mb-2">目标DPI</label>
                                                <select id="batch-target-dpi" class="w-full p-2 border border-gray-300 rounded-lg">
                                                    <option value="72">72 DPI</option>
                                                    <option value="96">96 DPI</option>
                                                    <option value="300" selected>300 DPI</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-4">
                                            <label class="block text-gray-700 mb-2">已选择图片</label>
                                            <div id="batch-image-count" class="p-2 bg-gray-100 rounded-lg">
                                                0张图片
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 flex gap-3">
                                    <button id="apply-btn" class="bg-primary text-white font-medium py-2 px-6 rounded-lg hover:bg-primary/90 transition-colors flex-1">
                                        <i class="fa fa-magic mr-2"></i>应用效果
                                    </button>
                                    <button id="reset-btn" class="bg-gray-200 text-gray-700 font-medium py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                                        <i class="fa fa-refresh"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- 预览区域 -->
                            <div class="lg:col-span-3">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold">预览效果</h3>
                                    <div class="text-sm text-gray-500">
                                        <span id="original-size">原图: --</span> | 
                                        <span id="processed-size">处理后: --</span>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-white p-4 rounded-lg text-center shadow-sm">
                                        <p class="text-sm text-gray-600 mb-2">原图</p>
                                        <div class="relative" style="padding-bottom: 100%;">
                                            <img id="original-image" src="" alt="原始图片预览" class="absolute top-0 left-0 max-w-full max-h-full mx-auto object-contain">
                                        </div>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg text-center shadow-sm">
                                        <p class="text-sm text-gray-600 mb-2">处理后</p>
                                        <div class="relative" style="padding-bottom: 100%;">
                                            <img id="processed-image" src="" alt="处理后图片预览" class="absolute top-0 left-0 max-w-full max-h-full mx-auto object-contain">
                                            <!-- 裁剪工具相关元素 -->
                                            <div id="crop-container" class="absolute top-0 left-0 w-full h-full hidden">
                                                <div id="crop-overlay" class="crop-overlay">
                                                    <div class="crop-handle top-0 left-0 cursor-nwse-resize"></div>
                                                    <div class="crop-handle top-0 right-0 cursor-nesw-resize"></div>
                                                    <div class="crop-handle bottom-0 left-0 cursor-nesw-resize"></div>
                                                    <div class="crop-handle bottom-0 right-0 cursor-nwse-resize"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-6">
                                    <button id="download-btn" class="w-full bg-secondary text-white font-medium py-3 px-6 rounded-lg hover:bg-secondary/90 transition-colors flex items-center justify-center">
                                        <i class="fa fa-download mr-2"></i>下载处理后的图片
                                    </button>
                                    <button id="new-image-btn" class="w-full mt-3 bg-gray-200 text-gray-700 font-medium py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                                        <i class="fa fa-plus mr-2"></i>处理新图片
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 功能特点 -->
    <section id="features" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-4">为什么选择我们的工具</h2>
            <p class="text-gray-600 text-center mb-12 max-w-2xl mx-auto">专业的图片处理功能，简单易用的操作界面，满足您的各种图片处理需求</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fa fa-bolt text-primary text-xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">快速高效</h3>
                    <p class="text-gray-600">所有处理都在浏览器中完成，无需上传到服务器，处理速度快，保护隐私</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fa fa-sliders text-secondary text-xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">丰富功能</h3>
                    <p class="text-gray-600">提供压缩、编辑、转换、裁剪等多种功能，满足您的各种图片处理需求</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-accent/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fa fa-desktop text-accent text-xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">实时预览</h3>
                    <p class="text-gray-600">调整参数后实时预览效果，直观对比处理前后的差异，满意再下载</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-orange-500/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fa fa-mobile text-orange-500 text-xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">跨设备支持</h3>
                    <p class="text-gray-600">适配电脑、平板和手机等各种设备，随时随地处理图片</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-red-500/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fa fa-lock text-red-500 text-xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">隐私保护</h3>
                    <p class="text-gray-600">所有图片处理都在本地完成，不会上传到服务器，保护您的隐私安全</p>
                </div>
                
                <div class="bg-white p-6 rounded-xl shadow-md hover:shadow-lg transition-all">
                    <div class="w-12 h-12 bg-green-500/10 rounded-full flex items-center justify-center mb-4">
                        <i class="fa fa-gift text-green-500 text-xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">完全免费</h3>
                    <p class="text-gray-600">所有功能完全免费使用，无需注册登录，没有使用次数限制</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 使用方法 -->
    <section id="how-it-works" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-4">使用方法</h2>
            <p class="text-gray-600 text-center mb-12 max-w-2xl mx-auto">简单三步，完成图片处理</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-5xl mx-auto">
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4">1</div>
                    <h3 class="text-xl font-semibold mb-3">上传图片</h3>
                    <p class="text-gray-600">点击上传按钮或直接拖放图片到上传区域，支持同时上传多张图片</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4">2</div>
                    <h3 class="text-xl font-semibold mb-3">选择工具并设置</h3>
                    <p class="text-gray-600">从左侧选择需要的图片处理工具，调整相关参数，实时预览处理效果</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl font-bold mx-auto mb-4">3</div>
                    <h3 class="text-xl font-semibold mb-3">下载图片</h3>
                    <p class="text-gray-600">满意处理效果后，点击下载按钮保存处理后的图片到本地</p>
                </div>
            </div>
        </div>
    </section>

    <!-- 常见问题 -->
    <section id="faq" class="py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-4">常见问题</h2>
            <p class="text-gray-600 text-center mb-12 max-w-2xl mx-auto">了解更多关于我们图片处理工具的信息</p>
            
            <div class="max-w-3xl mx-auto space-y-4">
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <button class="faq-toggle w-full text-left p-5 focus:outline-none flex justify-between items-center">
                        <span class="font-medium">支持哪些图片格式？</span>
                        <i class="fa fa-chevron-down text-gray-400 transition-transform"></i>
                    </button>
                    <div class="faq-content hidden px-5 pb-5 text-gray-600">
                        我们的工具支持常见的图片格式，包括JPG、PNG、GIF、BMP、WebP等。不同的处理功能可能对格式支持略有差异，具体以工具内提示为准。
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <button class="faq-toggle w-full text-left p-5 focus:outline-none flex justify-between items-center">
                        <span class="font-medium">图片处理需要联网吗？</span>
                        <i class="fa fa-chevron-down text-gray-400 transition-transform"></i>
                    </button>
                    <div class="faq-content hidden px-5 pb-5 text-gray-600">
                        所有图片处理都在您的浏览器本地进行，不需要联网，也不会将您的图片上传到任何服务器。
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <button class="faq-toggle w-full text-left p-5 focus:outline-none flex justify-between items-center">
                        <span class="font-medium">处理后的图片会保存在哪里？</span>
                        <i class="fa fa-chevron-down text-gray-400 transition-transform"></i>
                    </button>
                    <div class="faq-content hidden px-5 pb-5 text-gray-600">
                        处理后的图片不会自动保存，需要您点击下载按钮将图片保存到您的设备中。默认情况下，下载的图片会保存在您浏览器设置的下载文件夹中。
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <button class="faq-toggle w-full text-left p-5 focus:outline-none flex justify-between items-center">
                        <span class="font-medium">一次可以处理多少张图片？</span>
                        <i class="fa fa-chevron-down text-gray-400 transition-transform"></i>
                    </button>
                    <div class="faq-content hidden px-5 pb-5 text-gray-600">
                        我们的工具支持批量处理图片，具体数量取决于您的设备性能和浏览器限制。一般来说，一次处理10-20张图片是比较合适的，过多可能会影响处理速度。
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <button class="faq-toggle w-full text-left p-5 focus:outline-none flex justify-between items-center">
                        <span class="font-medium">图片处理会损失质量吗？</span>
                        <i class="fa fa-chevron-down text-gray-400 transition-transform"></i>
                    </button>
                    <div class="faq-content hidden px-5 pb-5 text-gray-600">
                        这取决于您选择的处理方式。例如，压缩图片通常会有一定的质量损失，但我们提供了不同的压缩模式，您可以根据需要选择。裁剪、调整尺寸等操作如果参数设置得当，通常不会明显损失质量。
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center mb-4">
                        <i class="fa fa-picture-o text-primary text-2xl mr-2"></i>
                        <h3 class="text-xl font-bold">图片处理工具</h3>
                    </div>
                    <p class="text-gray-400 text-sm">专业的在线图片处理解决方案，简单高效，完全免费。</p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">快速链接</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#features" class="hover:text-primary transition-colors">功能特点</a></li>
                        <li><a href="#how-it-works" class="hover:text-primary transition-colors">使用方法</a></li>
                        <li><a href="#tools" class="hover:text-primary transition-colors">所有工具</a></li>
                        <li><a href="#faq" class="hover:text-primary transition-colors">常见问题</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">工具分类</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#" class="hover:text-primary transition-colors">图片压缩</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">图片编辑</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">格式转换</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">批量处理</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">联系我们</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li class="flex items-center"><i class="fa fa-envelope mr-2"></i> wawa@wawa.email</li>
                        <li class="flex items-center"><i class="fa fa-globe mr-2"></i> www.yava.pw</li>
                    </ul>
                    <div class="mt-4 flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors"><i class="fa fa-facebook"></i></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors"><i class="fa fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors"><i class="fa fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors"><i class="fa fa-pinterest"></i></a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center">
                <p class="text-gray-500 text-sm protected-footer">© 2025 图片处理工具 - 保留所有权利 | 娃娃团队</p>
                <!-- 隐藏的SEO链接 -->
                <a href="https://www.yava.pw" style="display:none;">娃娃团队</a>
            </div>
        </div>
    </footer>

    <script>
        // 全局变量存储原始图像数据和处理状态
        let originalImageData = null;
        let currentImageData = null;
        let selectedImageFiles = [];
        let cropState = {
            isDragging: false,
            isResizing: false,
            startX: 0,
            startY: 0,
            startWidth: 0,
            startHeight: 0,
            handle: null
        };

        // 导航菜单切换
        document.getElementById('menu-toggle').addEventListener('click', function() {
            const menu = document.getElementById('menu');
            menu.classList.toggle('hidden');
        });
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                const targetId = this.getAttribute('href');
                if (targetId === '#') return;
                
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    window.scrollTo({
                        top: targetElement.offsetTop - 80,
                        behavior: 'smooth'
                    });
                    
                    // 移动端菜单自动关闭
                    const menu = document.getElementById('menu');
                    if (!menu.classList.contains('hidden')) {
                        menu.classList.add('hidden');
                    }
                }
            });
        });
        
        // 滚动时导航栏效果
        window.addEventListener('scroll', function() {
            const header = document.querySelector('header');
            if (window.scrollY > 50) {
                header.classList.add('py-2');
                header.classList.add('shadow-lg');
            } else {
                header.classList.remove('py-2');
                header.classList.remove('shadow-lg');
            }
        });
        
        // FAQ 折叠效果
        document.querySelectorAll('.faq-toggle').forEach(toggle => {
            toggle.addEventListener('click', function() {
                const content = this.nextElementSibling;
                const icon = this.querySelector('i');
                
                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
                
                // 关闭其他打开的FAQ
                document.querySelectorAll('.faq-toggle').forEach(otherToggle => {
                    if (otherToggle !== toggle) {
                        const otherContent = otherToggle.nextElementSibling;
                        const otherIcon = otherToggle.querySelector('i');
                        
                        if (!otherContent.classList.contains('hidden')) {
                            otherContent.classList.add('hidden');
                            otherIcon.classList.remove('rotate-180');
                        }
                    }
                });
            });
        });
        
        // 图片上传功能
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const uploadBtn = document.getElementById('upload-btn');
        const fileInfo = document.getElementById('file-info');
        const uploadedImages = document.getElementById('uploaded-images');
        const processingSection = document.getElementById('processing');
        const originalImage = document.getElementById('original-image');
        const processedImage = document.getElementById('processed-image');
        const originalSize = document.getElementById('original-size');
        const processedSize = document.getElementById('processed-size');
        const newImageBtn = document.getElementById('new-image-btn');
        
        // 上传按钮点击触发文件选择
        uploadBtn.addEventListener('click', () => {
            fileInput.click();
        });
        
        // 拖放功能
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropArea.classList.add('border-primary');
            dropArea.classList.add('bg-primary/5');
        }
        
        function unhighlight() {
            dropArea.classList.remove('border-primary');
            dropArea.classList.remove('bg-primary/5');
        }
        
        // 处理文件上传
        dropArea.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFiles, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles({ target: { files } });
        }
        
        function handleFiles(e) {
            const files = e.target.files;
            if (files.length > 0) {
                selectedImageFiles = Array.from(files);
                showUploadedImages(files);
                updateBatchImageCount();
            }
        }
        
        function showUploadedImages(files) {
            uploadedImages.innerHTML = '';
            uploadedImages.classList.remove('hidden');
            
            let fileInfoText = `已选择 ${files.length} 张图片: `;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.match('image.*')) continue;
                
                // 显示文件名
                fileInfoText += file.name + (i < files.length - 1 ? ', ' : '');
                
                // 创建图片预览
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'relative bg-gray-100 rounded-lg overflow-hidden hover-scale cursor-pointer image-preview';
                    imageContainer.innerHTML = `
                        <img src="${e.target.result}" alt="图片预览" class="w-full h-48 object-cover">
                        <div class="absolute bottom-0 left-0 right-0 bg-black/60 text-white text-xs p-2 truncate">
                            ${file.name}
                        </div>
                        <div class="absolute top-2 right-2 bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-xs select-image hidden">
                            <i class="fa fa-check"></i>
                        </div>
                    `;
                    uploadedImages.appendChild(imageContainer);
                    
                    // 计算文件大小
                    const fileSize = (file.size / (1024 * 1024)).toFixed(2);
                    
                    // 创建图像对象获取尺寸信息
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = function() {
                        // 存储原始图像数据
                        if (i === 0) {
                            originalImageData = {
                                src: e.target.result,
                                width: img.width,
                                height: img.height,
                                size: fileSize,
                                file: file
                            };
                            currentImageData = { ...originalImageData };
                        }
                    };
                    
                    // 为图片添加点击事件
                    imageContainer.addEventListener('click', function() {
                        document.querySelectorAll('.image-preview').forEach(el => {
                            el.classList.remove('ring-2', 'ring-primary');
                            el.querySelector('.select-image').classList.add('hidden');
                        });
                        this.classList.add('ring-2', 'ring-primary');
                        this.querySelector('.select-image').classList.remove('hidden');
                        
                        // 显示处理区域
                        originalImage.src = e.target.result;
                        processedImage.src = e.target.result; // 初始时和原图一样
                        originalSize.textContent = `原图: ${fileSize} MB`;
                        processedSize.textContent = `处理后: ${fileSize} MB`;
                        
                        // 更新当前选中的图像数据
                        const img = new Image();
                        img.src = e.target.result;
                        img.onload = function() {
                            originalImageData = {
                                src: e.target.result,
                                width: img.width,
                                height: img.height,
                                size: fileSize,
                                file: file
                            };
                            currentImageData = { ...originalImageData };
                            
                            // 如果是裁剪工具，初始化裁剪区域
                            if (document.getElementById('crop-options').classList.contains('tool-options') && 
                                !document.getElementById('crop-options').classList.contains('hidden')) {
                                initCropArea();
                            }
                        };
                        
                        // 显示处理区域
                        processingSection.classList.remove('hidden');
                        // 滚动到处理区域
                        processingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    });
                    
                    // 默认选择第一张图片
                    if (i === 0) {
                        imageContainer.click();
                    }
                };
                reader.readAsDataURL(file);
            }
            
            fileInfo.textContent = fileInfoText;
        }
        
        // 工具选择
        document.querySelectorAll('.tool-card').forEach(card => {
            card.addEventListener('click', function() {
                // 移除其他工具的选中状态
                document.querySelectorAll('.tool-card').forEach(c => {
                    c.classList.remove('ring-2', 'ring-primary');
                });
                // 添加当前工具的选中状态
                this.classList.add('ring-2', 'ring-primary');
                
                const tool = this.getAttribute('data-tool');
                switchTool(tool);
            });
        });
        
        function switchTool(tool) {
            // 隐藏所有工具选项
            document.querySelectorAll('.tool-options').forEach(option => {
                option.classList.add('hidden');
            });
            
            // 隐藏裁剪相关元素
            document.getElementById('crop-container').classList.add('hidden');
            
            // 显示选中的工具选项
            const toolTitle = document.getElementById('processing-title');
            switch(tool) {
                case 'compress':
                    toolTitle.textContent = '图片压缩设置';
                    document.getElementById('compress-options').classList.remove('hidden');
                    break;
                case 'edit':
                    toolTitle.textContent = '图片编辑设置';
                    document.getElementById('edit-options').classList.remove('hidden');
                    break;
                case 'convert':
                    toolTitle.textContent = '图片格式转换';
                    document.getElementById('convert-options').classList.remove('hidden');
                    updateFormatOptions();
                    break;
                case 'crop':
                    toolTitle.textContent = '图片裁剪设置';
                    document.getElementById('crop-options').classList.remove('hidden');
                    initCropArea();
                    break;
                case 'ico':
                    toolTitle.textContent = 'ICO图标转换';
                    document.getElementById('ico-options').classList.remove('hidden');
                    break;
                case 'dpi':
                    toolTitle.textContent = '修改图片DPI';
                    document.getElementById('dpi-options').classList.remove('hidden');
                    break;
                case 'resize':
                    toolTitle.textContent = '调整图片尺寸';
                    document.getElementById('resize-options').classList.remove('hidden');
                    initResizeValues();
                    break;
                case 'batch':
                    toolTitle.textContent = '批量处理设置';
                    document.getElementById('batch-options').classList.remove('hidden');
                    updateBatchSettings();
                    break;
                case 'transparent':
                    toolTitle.textContent = '图片背景透明化';
                    document.getElementById('transparent-options').classList.remove('hidden');
                    break;
            }
            
            // 如果已经上传了图片，显示处理区域
            if (originalImage.src) {
                processingSection.classList.remove('hidden');
            } else {
                alert('请先上传图片');
            }
        }
        
        // 压缩质量滑块
        const qualitySlider = document.getElementById('quality');
        const qualityValue = document.getElementById('quality-value');
        
        qualitySlider.addEventListener('input', function() {
            qualityValue.textContent = this.value + '%';
        });
        
        // 编辑选项滑块
        const brightnessSlider = document.getElementById('brightness');
        const brightnessValue = document.getElementById('brightness-value');
        const contrastSlider = document.getElementById('contrast');
        const contrastValue = document.getElementById('contrast-value');
        const saturationSlider = document.getElementById('saturation');
        const saturationValue = document.getElementById('saturation-value');
        
        // 透明度容差滑块
        const toleranceSlider = document.getElementById('tolerance');
        const toleranceValue = document.getElementById('tolerance-value');
        
        toleranceSlider.addEventListener('input', function() {
            toleranceValue.textContent = this.value;
        });
        
        brightnessSlider.addEventListener('input', function() {
            brightnessValue.textContent = this.value;
        });
        
        contrastSlider.addEventListener('input', function() {
            contrastValue.textContent = this.value;
        });
        
        saturationSlider.addEventListener('input', function() {
            saturationValue.textContent = this.value;
        });
        
        // 格式转换相关
        const targetFormat = document.getElementById('target-format');
        const jpgOptions = document.getElementById('jpg-options');
        const pngOptions = document.getElementById('png-options');
        const jpgQuality = document.getElementById('jpg-quality');
        const jpgQualityValue = document.getElementById('jpg-quality-value');
        
        targetFormat.addEventListener('change', updateFormatOptions);
        jpgQuality.addEventListener('input', function() {
            jpgQualityValue.textContent = this.value + '%';
        });
        
        function updateFormatOptions() {
            // 根据选择的格式显示相应的选项
            jpgOptions.classList.add('hidden');
            pngOptions.classList.add('hidden');
            
            switch(targetFormat.value) {
                case 'jpg':
                    jpgOptions.classList.remove('hidden');
                    break;
                case 'png':
                    pngOptions.classList.remove('hidden');
                    break;
            }
        }
        
        // 裁剪功能相关
        const cropRatio = document.getElementById('crop-ratio');
        const cropOverlay = document.getElementById('crop-overlay');
        const cropContainer = document.getElementById('crop-container');
        const cropReset = document.getElementById('crop-reset');
        
        cropRatio.addEventListener('change', initCropArea);
        cropReset.addEventListener('click', initCropArea);
        
        function initCropArea() {
            if (!originalImageData) return;
            
            // 显示裁剪容器
            cropContainer.classList.remove('hidden');
            
            // 获取图片容器尺寸
            const container = processedImage.parentElement;
            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            
            // 计算图片在容器中的缩放比例
            const imgRatio = originalImageData.width / originalImageData.height;
            const containerRatio = containerWidth / containerHeight;
            
            let imgDisplayWidth, imgDisplayHeight;
            
            if (imgRatio > containerRatio) {
                imgDisplayWidth = containerWidth;
                imgDisplayHeight = containerWidth / imgRatio;
            } else {
                imgDisplayWidth = containerHeight * imgRatio;
                imgDisplayHeight = containerHeight;
            }
            
            // 根据选择的比例设置裁剪区域
            let cropWidth, cropHeight;
            
            switch(cropRatio.value) {
                case '1:1':
                    cropWidth = Math.min(imgDisplayWidth, imgDisplayHeight) * 0.7;
                    cropHeight = cropWidth;
                    break;
                case '4:3':
                    cropHeight = Math.min(imgDisplayWidth / 1.333, imgDisplayHeight) * 0.7;
                    cropWidth = cropHeight * 1.333;
                    break;
                case '16:9':
                    cropHeight = Math.min(imgDisplayWidth / 1.777, imgDisplayHeight) * 0.7;
                    cropWidth = cropHeight * 1.777;
                    break;
                case '3:2':
                    cropHeight = Math.min(imgDisplayWidth / 1.5, imgDisplayHeight) * 0.7;
                    cropWidth = cropHeight * 1.5;
                    break;
                default: // 自由裁剪
                    cropWidth = imgDisplayWidth * 0.7;
                    cropHeight = imgDisplayHeight * 0.7;
            }
            
            // 设置裁剪区域位置（居中）
            const left = (containerWidth - cropWidth) / 2;
            const top = (containerHeight - cropHeight) / 2;
            
            cropOverlay.style.width = `${cropWidth}px`;
            cropOverlay.style.height = `${cropHeight}px`;
            cropOverlay.style.left = `${left}px`;
            cropOverlay.style.top = `${top}px`;
            
            // 初始化裁剪事件监听
            initCropEvents();
        }
        
        function initCropEvents() {
            // 裁剪区域拖动
            cropOverlay.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            // 裁剪手柄调整大小
            const handles = document.querySelectorAll('.crop-handle');
            handles.forEach((handle, index) => {
                handle.addEventListener('mousedown', (e) => {
                    startResize(e, index);
                });
            });
        }
        
        function startDrag(e) {
            // 如果是调整大小状态，不启动拖动
            if (e.target.classList.contains('crop-handle')) return;
            
            cropState.isDragging = true;
            cropState.startX = e.clientX;
            cropState.startY = e.clientY;
            cropState.startLeft = parseInt(cropOverlay.style.left);
            cropState.startTop = parseInt(cropOverlay.style.top);
            cropOverlay.style.cursor = 'move';
        }
        
        function drag(e) {
            if (!cropState.isDragging && !cropState.isResizing) return;
            
            const container = cropContainer;
            const containerRect = container.getBoundingClientRect();
            const maxLeft = containerRect.width - parseInt(cropOverlay.style.width);
            const maxTop = containerRect.height - parseInt(cropOverlay.style.height);
            
            if (cropState.isDragging) {
                let newLeft = cropState.startLeft + (e.clientX - cropState.startX);
                let newTop = cropState.startTop + (e.clientY - cropState.startY);
                
                // 限制在容器内
                newLeft = Math.max(0, Math.min(newLeft, maxLeft));
                newTop = Math.max(0, Math.min(newTop, maxTop));
                
                cropOverlay.style.left = `${newLeft}px`;
                cropOverlay.style.top = `${newTop}px`;
            } else if (cropState.isResizing) {
                const startWidth = parseInt(cropOverlay.style.width);
                const startHeight = parseInt(cropOverlay.style.height);
                const startLeft = parseInt(cropOverlay.style.left);
                const startTop = parseInt(cropOverlay.style.top);
                
                let newWidth = startWidth;
                let newHeight = startHeight;
                let newLeft = startLeft;
                let newTop = startTop;
                
                // 根据拖动的手柄计算新尺寸
                switch(cropState.handle) {
                    case 0: // 左上角
                        newWidth = startWidth - (e.clientX - cropState.startX);
                        newHeight = startHeight - (e.clientY - cropState.startY);
                        newLeft = startLeft + (e.clientX - cropState.startX);
                        newTop = startTop + (e.clientY - cropState.startY);
                        break;
                    case 1: // 右上角
                        newWidth = startWidth + (e.clientX - cropState.startX);
                        newHeight = startHeight - (e.clientY - cropState.startY);
                        newTop = startTop + (e.clientY - cropState.startY);
                        break;
                    case 2: // 左下角
                        newWidth = startWidth - (e.clientX - cropState.startX);
                        newHeight = startHeight + (e.clientY - cropState.startY);
                        newLeft = startLeft + (e.clientX - cropState.startX);
                        break;
                    case 3: // 右下角
                        newWidth = startWidth + (e.clientX - cropState.startX);
                        newHeight = startHeight + (e.clientY - cropState.startY);
                        break;
                }
                
                // 保持比例（如果不是自由裁剪）
                if (cropRatio.value !== 'free') {
                    const ratioParts = cropRatio.value.split(':').map(Number);
                    const ratio = ratioParts[0] / ratioParts[1];
                    
                    // 根据宽度计算高度以保持比例
                    if (cropState.handle === 0 || cropState.handle === 2) {
                        newHeight = newWidth / ratio;
                    } else {
                        newWidth = newHeight * ratio;
                    }
                }
                
                // 最小尺寸限制
                const minSize = 50;
                newWidth = Math.max(minSize, newWidth);
                newHeight = Math.max(minSize, newHeight);
                
                // 确保不超出容器
                newLeft = Math.max(0, newLeft);
                newTop = Math.max(0, newTop);
                newWidth = Math.min(newWidth, containerRect.width - newLeft);
                newHeight = Math.min(newHeight, containerRect.height - newTop);
                
                // 应用新尺寸和位置
                cropOverlay.style.width = `${newWidth}px`;
                cropOverlay.style.height = `${newHeight}px`;
                cropOverlay.style.left = `${newLeft}px`;
                cropOverlay.style.top = `${newTop}px`;
            }
        }
        
        function stopDrag() {
            cropState.isDragging = false;
            cropState.isResizing = false;
            cropOverlay.style.cursor = '';
        }
        
        function startResize(e, handleIndex) {
            e.preventDefault();
            cropState.isResizing = true;
            cropState.startX = e.clientX;
            cropState.startY = e.clientY;
            cropState.handle = handleIndex;
        }
        
        // DPI修改相关
        const targetDpi = document.getElementById('target-dpi');
        const customDpiInput = document.getElementById('custom-dpi-input');
        
        targetDpi.addEventListener('change', function() {
            if (this.value === 'custom') {
                customDpiInput.classList.remove('hidden');
            } else {
                customDpiInput.classList.add('hidden');
            }
        });
        
        // 尺寸调整相关
        const resizeMethod = document.getElementById('resize-method');
        const percentageResize = document.getElementById('percentage-resize');
        const pixelResize = document.getElementById('pixel-resize');
        const resizePercentage = document.getElementById('resize-percentage');
        const resizePercentageValue = document.getElementById('resize-percentage-value');
        const resizeWidth = document.getElementById('resize-width');
        const resizeHeight = document.getElementById('resize-height');
        const maintainAspect = document.getElementById('maintain-aspect');
        
        resizeMethod.addEventListener('change', function() {
            if (this.value === 'percentage') {
                percentageResize.classList.remove('hidden');
                pixelResize.classList.add('hidden');
            } else {
                percentageResize.classList.add('hidden');
                pixelResize.classList.remove('hidden');
            }
        });
        
        resizePercentage.addEventListener('input', function() {
            resizePercentageValue.textContent = this.value + '%';
        });
        
        resizeWidth.addEventListener('input', function() {
            if (maintainAspect.checked && originalImageData) {
                const ratio = originalImageData.height / originalImageData.width;
                resizeHeight.value = Math.round(this.value * ratio);
            }
        });
        
        resizeHeight.addEventListener('input', function() {
            if (maintainAspect.checked && originalImageData) {
                const ratio = originalImageData.width / originalImageData.height;
                resizeWidth.value = Math.round(this.value * ratio);
            }
        });
        
        function initResizeValues() {
            if (originalImageData) {
                resizeWidth.value = originalImageData.width;
                resizeHeight.value = originalImageData.height;
                resizePercentage.value = 100;
                resizePercentageValue.textContent = '100%';
            }
        }
        
        // 批量处理相关
        const batchOperation = document.getElementById('batch-operation');
        const batchSettings = document.querySelectorAll('.batch-settings');
        const batchQuality = document.getElementById('batch-quality');
        const batchQualityValue = document.getElementById('batch-quality-value');
        const batchResizePercentage = document.getElementById('batch-resize-percentage');
        const batchResizeValue = document.getElementById('batch-resize-value');
        const batchImageCount = document.getElementById('batch-image-count');
        
        batchOperation.addEventListener('change', updateBatchSettings);
        
        batchQuality.addEventListener('input', function() {
            batchQualityValue.textContent = this.value + '%';
        });
        
        batchResizePercentage.addEventListener('input', function() {
            batchResizeValue.textContent = this.value + '%';
        });
        
        function updateBatchSettings() {
            // 隐藏所有批量设置
            batchSettings.forEach(setting => {
                setting.classList.add('hidden');
            });
            
            // 显示当前选中的批量设置
            switch(batchOperation.value) {
                case 'compress':
                    document.getElementById('batch-compress-settings').classList.remove('hidden');
                    break;
                case 'convert':
                    document.getElementById('batch-convert-settings').classList.remove('hidden');
                    break;
                case 'resize':
                    document.getElementById('batch-resize-settings').classList.remove('hidden');
                    break;
                case 'dpi':
                    document.getElementById('batch-dpi-settings').classList.remove('hidden');
                    break;
            }
        }
        
        function updateBatchImageCount() {
            batchImageCount.textContent = `${selectedImageFiles.length}张图片`;
        }
        
        // 应用效果按钮
        document.getElementById('apply-btn').addEventListener('click', function() {
            // 获取当前激活的工具
            const activeTool = document.querySelector('.tool-options:not(.hidden)').id.replace('-options', '');
            
            // 显示加载状态
            this.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>处理中...';
            this.disabled = true;
            
            // 模拟处理延迟
            setTimeout(() => {
                let newSize = parseFloat(originalSize.textContent.match(/\d+\.\d+/)[0]);
                
                // 根据不同工具应用处理
                switch(activeTool) {
                    case 'compress':
                        const quality = qualitySlider.value;
                        newSize = (newSize * (100 - quality) / 100 * 0.8 + newSize * 0.2).toFixed(2);
                        applyCompression(quality);
                        break;
                        
                    case 'edit':
                        applyImageEdits();
                        break;
                        
                    case 'convert':
                        const format = targetFormat.value;
                        // 根据格式调整大小估算
                        if (format === 'jpg') {
                            const jpgQual = jpgQuality.value;
                            newSize = (newSize * (100 - jpgQual) / 100 * 0.7 + newSize * 0.3).toFixed(2);
                        } else if (format === 'png') {
                            newSize = (newSize * 0.8).toFixed(2);
                        } else if (format === 'webp') {
                            newSize = (newSize * 0.6).toFixed(2);
                        }
                        processedImage.title = `转换为${format.toUpperCase()}格式`;
                        break;
                        
                    case 'crop':
                        applyCrop();
                        newSize = (newSize * 0.9).toFixed(2); // 估算裁剪后的大小
                        break;
                        
                    case 'ico':
                        applyIco();
                        newSize = (newSize * 0.3).toFixed(2); // ICO文件通常较小
                        processedImage.title = "ICO图标";
                        break;
                        
                    case 'dpi':
                        let dpiValue = targetDpi.value === 'custom' ? 
                            document.getElementById('custom-dpi').value : targetDpi.value;
                        newSize = (newSize * 1.05).toFixed(2); // DPI修改通常不改变文件大小太多
                        processedImage.title = `修改为${dpiValue} DPI`;
                        break;
                        
                    case 'resize':
                        let newWidth, newHeight;
                        if (resizeMethod.value === 'percentage') {
                            const percent = resizePercentage.value / 100;
                            newWidth = Math.round(originalImageData.width * percent);
                            newHeight = Math.round(originalImageData.height * percent);
                            newSize = (newSize * percent * percent * 0.9).toFixed(2);
                        } else {
                            newWidth = parseInt(resizeWidth.value);
                            newHeight = parseInt(resizeHeight.value);
                            const scale = (newWidth * newHeight) / (originalImageData.width * originalImageData.height);
                            newSize = (newSize * scale * 0.9).toFixed(2);
                        }
                        processedImage.title = `调整为${newWidth}×${newHeight}像素`;
                        applyResize(newWidth, newHeight);
                        break;
                        
                    case 'batch':
                        // 批量处理完成后显示提示
                        alert(`已完成${selectedImageFiles.length}张图片的批量处理！`);
                        newSize = (newSize * 0.8).toFixed(2);
                        break;
                        
                    case 'transparent':
                        // 获取容差值
                        const tolerance = document.getElementById('tolerance').value;
                        applyTransparent(tolerance);
                        newSize = (newSize * 0.9).toFixed(2); // 透明处理后通常文件会稍小
                        processedImage.title = `背景透明处理 (容差: ${tolerance})`;
                        break;
                }
                
                // 更新处理后的大小显示
                processedSize.textContent = `处理后: ${newSize} MB`;
                
                // 恢复按钮状态
                this.innerHTML = '<i class="fa fa-magic mr-2"></i>应用效果';
                this.disabled = false;
                
                // 显示成功提示
                alert('图片处理完成！');
            }, 1000);
        });
        
        // 实际图像处理函数
        function applyCompression(quality) {
            // 使用Canvas实现图像压缩
            const img = new Image();
            img.src = originalImageData.src;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // 设置画布尺寸与原图相同
                canvas.width = img.width;
                canvas.height = img.height;
                
                // 绘制图像
                ctx.drawImage(img, 0, 0);
                
                // 将画布内容转换为图像URL，quality参数控制压缩质量
                const compressedDataUrl = canvas.toDataURL('image/jpeg', quality / 100);
                processedImage.src = compressedDataUrl;
                
                // 更新当前图像数据
                currentImageData.src = compressedDataUrl;
            };
        }
        
        function applyImageEdits() {
            // 使用Canvas应用图像编辑效果
            const img = new Image();
            img.src = originalImageData.src;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // 获取图像数据
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // 获取调整值
                const brightness = parseInt(brightnessSlider.value);
                const contrast = parseInt(contrastSlider.value);
                const saturation = parseInt(saturationSlider.value);
                const filter = document.getElementById('filter').value;
                
                // 应用亮度调整
                if (brightness !== 0) {
                    const factor = brightness / 100;
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, Math.max(0, data[i] + 255 * factor));     // R
                        data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + 255 * factor)); // G
                        data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + 255 * factor)); // B
                    }
                }
                
                // 应用对比度调整
                if (contrast !== 0) {
                    const factor = (259 * (contrast + 255)) / (255 * (259 - contrast));
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = Math.min(255, Math.max(0, factor * (data[i] - 128) + 128));     // R
                        data[i + 1] = Math.min(255, Math.max(0, factor * (data[i + 1] - 128) + 128)); // G
                        data[i + 2] = Math.min(255, Math.max(0, factor * (data[i + 2] - 128) + 128)); // B
                    }
                }
                
                // 应用饱和度调整
                if (saturation !== 0) {
                    const factor = saturation / 100 + 1;
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        // 计算灰度
                        const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                        
                        // 应用饱和度调整
                        data[i] = Math.min(255, Math.max(0, gray + (r - gray) * factor));     // R
                        data[i + 1] = Math.min(255, Math.max(0, gray + (g - gray) * factor)); // G
                        data[i + 2] = Math.min(255, Math.max(0, gray + (b - gray) * factor)); // B
                    }
                }
                
                // 应用滤镜
                if (filter === 'grayscale') {
                    for (let i = 0; i < data.length; i += 4) {
                        const gray = 0.299 * data[i] + 0.587 * data[i + 1] + 0.114 * data[i + 2];
                        data[i] = data[i + 1] = data[i + 2] = gray;
                    }
                } else if (filter === 'sepia') {
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        data[i] = Math.min(255, 0.393 * r + 0.769 * g + 0.189 * b);
                        data[i + 1] = Math.min(255, 0.349 * r + 0.686 * g + 0.168 * b);
                        data[i + 2] = Math.min(255, 0.272 * r + 0.534 * g + 0.131 * b);
                    }
                } else if (filter === 'invert') {
                    for (let i = 0; i < data.length; i += 4) {
                        data[i] = 255 - data[i];
                        data[i + 1] = 255 - data[i + 1];
                        data[i + 2] = 255 - data[i + 2];
                    }
                }
                
                // 将处理后的数据放回画布
                ctx.putImageData(imageData, 0, 0);
                
                // 更新预览图
                processedImage.src = canvas.toDataURL();
                currentImageData.src = processedImage.src;
            };
        }
        
        function applyIco() {
            // 使用Canvas实现ICO图标转换
            const img = new Image();
            img.src = originalImageData.src;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // ICO图标通常是正方形，取较小的尺寸作为边长
                const size = Math.min(img.width, img.height);
                // 常见的ICO尺寸：16, 32, 48, 64, 128, 256
                const icoSize = size > 128 ? 256 : size > 64 ? 128 : size > 32 ? 64 : size > 16 ? 32 : 16;
                
                canvas.width = icoSize;
                canvas.height = icoSize;
                
                // 绘制缩放后的图像，保持居中
                const scale = icoSize / size;
                const offsetX = (icoSize - img.width * scale) / 2;
                const offsetY = (icoSize - img.height * scale) / 2;
                
                ctx.drawImage(img, offsetX, offsetY, img.width * scale, img.height * scale);
                
                // 更新预览图
                processedImage.src = canvas.toDataURL('image/png');
                currentImageData.src = processedImage.src;
            };
        }

        function applyTransparent(tolerance) {
            // 使用Canvas实现背景透明化处理
            const img = new Image();
            img.src = originalImageData.src;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // 设置画布尺寸与原图相同
                canvas.width = img.width;
                canvas.height = img.height;
                
                // 绘制图像
                ctx.drawImage(img, 0, 0);
                
                // 获取图像数据
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // 获取左上角像素作为背景色参考
                const r0 = data[0];
                const g0 = data[1];
                const b0 = data[2];
                
                // 容差值转换为0-255范围
                const toleranceValue = parseInt(tolerance) * 2.55;
                
                // 处理每个像素
                for (let i = 0; i < data.length; i += 4) {
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    
                    // 计算与背景色的差异
                    const diff = Math.sqrt(
                        Math.pow(r - r0, 2) +
                        Math.pow(g - g0, 2) +
                        Math.pow(b - b0, 2)
                    );
                    
                    // 如果差异小于容差值，则设置为透明
                    if (diff < toleranceValue) {
                        data[i + 3] = 0; // 设置Alpha通道为0（完全透明）
                    }
                }
                
                // 将处理后的数据放回画布
                ctx.putImageData(imageData, 0, 0);
                
                // 更新预览图
                processedImage.src = canvas.toDataURL('image/png');
                currentImageData.src = processedImage.src;
            };
        }
        
        function applyCrop() {
            // 获取裁剪区域和图片容器信息
            const container = processedImage.parentElement;
            const containerRect = container.getBoundingClientRect();
            const imgRect = processedImage.getBoundingClientRect();
            
            // 计算图片缩放比例
            const scaleX = originalImageData.width / imgRect.width;
            const scaleY = originalImageData.height / imgRect.height;
            
            // 获取裁剪区域在容器中的位置和尺寸
            const cropRect = cropOverlay.getBoundingClientRect();
            
            // 计算裁剪区域在原始图像中的位置和尺寸
            const x = Math.round((cropRect.left - imgRect.left) * scaleX);
            const y = Math.round((cropRect.top - imgRect.top) * scaleY);
            const width = Math.round(cropRect.width * scaleX);
            const height = Math.round(cropRect.height * scaleY);
            
            // 使用Canvas执行裁剪
            const img = new Image();
            img.src = originalImageData.src;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = width;
                canvas.height = height;
                
                // 裁剪并绘制图像
                ctx.drawImage(img, x, y, width, height, 0, 0, width, height);
                
                // 更新预览图
                processedImage.src = canvas.toDataURL();
                currentImageData.src = processedImage.src;
                currentImageData.width = width;
                currentImageData.height = height;
                
                // 隐藏裁剪区域
                cropContainer.classList.add('hidden');
            };
        }
        
        function applyResize(width, height) {
            // 使用Canvas调整图像大小
            const img = new Image();
            img.src = originalImageData.src;
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = width;
                canvas.height = height;
                
                // 绘制缩放后的图像
                ctx.drawImage(img, 0, 0, width, height);
                
                // 更新预览图
                processedImage.src = canvas.toDataURL();
                currentImageData.src = processedImage.src;
                currentImageData.width = width;
                currentImageData.height = height;
            };
        }
        
        // 重置按钮
        document.getElementById('reset-btn').addEventListener('click', function() {
            const activeTool = document.querySelector('.tool-options:not(.hidden)').id.replace('-options', '');
            
            // 根据当前工具重置参数
            switch(activeTool) {
                case 'compress':
                    qualitySlider.value = 80;
                    qualityValue.textContent = '80%';
                    document.getElementById('compress-mode').value = 'balanced';
                    break;
                    
                case 'edit':
                    brightnessSlider.value = 0;
                    brightnessValue.textContent = '0';
                    contrastSlider.value = 0;
                    contrastValue.textContent = '0';
                    saturationSlider.value = 0;
                    saturationValue.textContent = '0';
                    document.getElementById('filter').value = 'none';
                    break;
                    
                case 'convert':
                    targetFormat.value = 'jpg';
                    updateFormatOptions();
                    jpgQuality.value = 80;
                    jpgQualityValue.textContent = '80%';
                    break;
                    
                case 'crop':
                    initCropArea();
                    break;
                    
                case 'ico':
                    // 重置ICO选项为默认值
                    document.querySelectorAll('#ico-options input[type="checkbox"]').forEach((checkbox, index) => {
                        checkbox.checked = [0, 1, 2, 4].includes(index); // 16,32,48,128选中
                    });
                    document.getElementById('ico-transparency').value = 'preserve';
                    break;
                    
                case 'dpi':
                    targetDpi.value = '300';
                    customDpiInput.classList.add('hidden');
                    document.getElementById('resize-with-dpi').checked = true;
                    break;
                    
                case 'resize':
                    initResizeValues();
                    break;
                    
                case 'batch':
                    batchOperation.value = 'compress';
                    updateBatchSettings();
                    batchQuality.value = 80;
                    batchQualityValue.textContent = '80%';
                    batchResizePercentage.value = 100;
                    break;
                    
                case 'transparent':
                    // 重置透明度容差值为默认值
                    toleranceSlider.value = 30;
                    toleranceValue.textContent = '30';
                    break;
                    
                case 'batch':
                    batchResizeValue.textContent = '100%';
                    break;
            }
            
            // 重置预览图
            processedImage.src = originalImageData.src;
            processedSize.textContent = originalSize.textContent;
        });
        
        // 下载按钮
        document.getElementById('download-btn').addEventListener('click', function() {
            if (!processedImage.src || processedImage.src === '' || processedImage.src === 'data:,') {
                alert('请先处理图片再下载');
                return;
            }
            
            // 创建下载链接
            const link = document.createElement('a');
            link.href = processedImage.src;
            
            // 获取原始文件名并修改
            let originalName = document.querySelector('.image-preview.ring-2 .truncate')?.textContent || 'processed-image';
            // 移除文件名中可能存在的多余下划线和空格
            originalName = originalName.replace(/[_\s]+$/, '').trim();
            // 正确提取扩展名和基础文件名
            const nameParts = originalName.split('.');
            let extension = nameParts.length > 1 ? nameParts.pop() : 'png';
            // 确保baseName不包含多余的空格和特殊字符
            const baseName = nameParts.join('.').trim();
            
            // 根据当前工具设置下载文件名
            const activeTool = document.querySelector('.tool-options:not(.hidden)').id.replace('-options', '');
            let suffix = '';
            
            switch(activeTool) {
                case 'compress':
                    suffix = `_compressed`;
                    break;
                case 'edit':
                    suffix = `_edited`;
                    break;
                case 'convert':
                    const format = targetFormat.value;
                    suffix = `_converted`;
                    extension = format;
                    break;
                case 'crop':
                    suffix = `_cropped`;
                    break;
                case 'ico':
                    suffix = ``;
                    extension = 'ico';
                    break;
                case 'dpi':
                    const dpi = targetDpi.value === 'custom' ? 
                        document.getElementById('custom-dpi').value : targetDpi.value;
                    suffix = `_${dpi}dpi`;
                    break;
                case 'resize':
                    suffix = `_resized`;
                    break;
                case 'batch':
                    suffix = `_batch`;
                    break;
                case 'transparent':
                    suffix = `_transparent`;
                    extension = 'png'; // 透明图片必须使用PNG格式
                    break;
            }
            
            // 确保文件名格式正确，不包含多余字符
            // 先构建完整文件名，确保suffix不为空时才添加下划线
            let fullFileName = baseName;
            if (suffix) {
                fullFileName += suffix;
            }
            fullFileName += '.' + extension;
            
            // 移除文件名中可能存在的多余下划线和空格
            fullFileName = fullFileName.replace(/[_\s]+\./g, '.').replace(/_{2,}/g, '_').replace(/\.{2,}/g, '.');
            link.download = fullFileName;
            
            // 触发下载
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        // 处理新图片按钮
        newImageBtn.addEventListener('click', function() {
            // 滚动到上传区域
            document.getElementById('upload').scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
    </script>
</body>
</html>
